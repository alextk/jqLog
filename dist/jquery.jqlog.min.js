/*
* jqLog - jQuery logging for javascript
*
* Version: 0.0.3
* Build: 89
* Copyright 2011 Alex Tkachev
*
* Dual licensed under MIT or GPLv2 licenses
*   http://en.wikipedia.org/wiki/MIT_License
*   http://en.wikipedia.org/wiki/GNU_General_Public_License
*
* Date: 11 Nov 2012 14:09:11
*/

(function(a){a.jqLog={classes:{}}})(jQuery),function(a){a.jqLog.Level={TRACE:{num:1,name:"TRACE"},DEBUG:{num:2,name:"DEBUG"},INFO:{num:3,name:"INFO"},WARN:{num:4,name:"WARN"},ERROR:{num:5,name:"ERROR"},FATAL:{num:6,name:"FATAL"},isLower:function(a,b){if(b&&b.num)return a.num<b.num;return!1},isRestricted:function(a,b){return a.num<b.num}}}(jQuery),function(a){a.jqLog.classes.Layouter=function(){this.initialize.apply(this,arguments)},a.extend(a.jqLog.classes.Layouter.prototype,{initialize:function(b){this.datePattern="%d-%m-%y %H:%M:%S",this.pattern="%{level} %{msg}",a.extend(this,b)},eventToString:function(a){return this.pattern.replace("%{level}",a.level.name).replace("%{name}",a.logger.name).replace("%{date}",a.date.strftime(this.datePattern)).replace("%{msg}",a.message)}})}(jQuery),function(a){a.jqLog.classes.Logger=function(){this.initialize.apply(this,arguments)},a.extend(a.jqLog.classes.Logger.prototype,{initialize:function(b){a.extend(this,b)},log:function(a,b,c){if(this.jqLog.isLevelEnabled(this,a)){if(arguments.length==3&&typeof c=="object")for(var d in c)b=b.replace("%{"+d+"}",c[d]).replace("{"+d+"}",c[d]);else if(arguments.length>2)for(var e=2;e<arguments.length;e++)b=b.replace("%{"+(e-2)+"}",arguments[e]).replace("{"+(e-2)+"}",arguments[e]);this.jqLog.doAppend(this,a,b)}}}),["trace","debug","info","warn","error","fatal"].each(function(b){a.jqLog.classes.Logger.prototype[b]=function(){Array.prototype.unshift.call(arguments,a.jqLog.Level[b.toUpperCase()]),this.log.apply(this,arguments)}})}(jQuery),function(a){a.jqLog.classes.LoggersManager=function(){this.initialize.apply(this,arguments)},a.extend(a.jqLog.classes.LoggersManager.prototype,{loggers:null,rootLogger:null,initialize:function(a){this.jqLog=a,this.reset()},reset:function(){this.loggers={},this.rootLogger=this.loggers._logger=new a.jqLog.classes.Logger({jqLog:this.jqLog,name:"",nameArr:[],level:a.jqLog.Level.DEBUG})},configure:function(a){a.root&&(this.rootLogger.level=a.root.level);for(var b in a)if(b!="root"){var c=a[b],d=this.logger(b);c.level&&(d.level=c.level)}},logger:function(b){if(!b||b.length===0)return this.rootLogger;var c=b.split("."),d=this.loggers;c.each(function(a){d[a]||(d[a]={_logger:null}),d=d[a]}),d._logger===null&&(d._logger=new a.jqLog.classes.Logger({jqLog:this.jqLog,name:b,nameArr:c}));return d._logger},inheritedLoggerLevel:function(a){if(a==this.rootLogger)return this.rootLogger.level;var b=this.loggers;for(var c=0;c<a.nameArr.length;c++){var d=a.nameArr[c];if(b[d]._logger&&b[d]._logger.level)return b[d]._logger.level;b=b[d]}return this.rootLogger.level},isLevelEnabled:function(b,c){if(b.level)return!a.jqLog.Level.isRestricted(c,b.level);return!a.jqLog.Level.isRestricted(c,this.inheritedLoggerLevel(b))}})}(jQuery),function(a){a.jqLog.classes.ArrayConsole=function(){this.initialize.apply(this,arguments)},a.extend(a.jqLog.classes.ArrayConsole.prototype,{enabled:!0,initialize:function(){this.buffer=[]},log:function(a,b){this[a](b)}}),["trace","debug","info","warn","error","fatal"].each(function(b){a.jqLog.classes.ArrayConsole.prototype[b]=function(a){this.buffer.push({method:b,message:a})}})}(jQuery),function(a){a.jqLog.classes.BrowserConsole=function(){this.initialize.apply(this,arguments)},a.extend(a.jqLog.classes.BrowserConsole.prototype,{initialize:function(){this.console=window.console,this.enabled=typeof this.console!=="undefined"&&this.console!==null},log:function(a,b){this[a](b)}}),["trace","debug","info","warn","error"].each(function(b){a.jqLog.classes.BrowserConsole.prototype[b]=function(a){this.console[b]?this.console[b](a):this.console.log(b+": "+a)}}),a.jqLog.classes.BrowserConsole.prototype.fatal=a.jqLog.classes.BrowserConsole.prototype.error}(jQuery),function(a){a.jqLog.classes.ConsoleAppender=function(){this.initialize.apply(this,arguments)};var b=a.jqLog.Level,c={};["trace","debug","info","warn","error","fatal"].each(function(a){c[b[a.toUpperCase()].name]=a}),a.jqLog.classes.ConsoleAppender.loggingMethodForLevel=function(a){return c[a.name]},a.extend(a.jqLog.classes.ConsoleAppender.prototype,{console:null,initialize:function(b){a.extend(this,b),this.console||(this.console=new a.jqLog.classes.BrowserConsole)},getLayouter:function(){return this.layouter||a.jqLog.rootLayouter()},doAppend:function(b){if(!this.console.enabled)return!1;var c=a.jqLog.classes.ConsoleAppender.loggingMethodForLevel(b.level),d=this.getLayouter().eventToString(b);this.console[c](d);return!0}})}(jQuery),function(a){a.jqLog.classes.JQLog=function(){this.initialize.apply(this,arguments)},a.extend(a.jqLog.classes.JQLog.prototype,{manager:null,appenders:null,rootLogger:null,defaultConfig:null,initialize:function(a){this.defaultConfig=a,this.reset()},reset:function(){this.manager=new a.jqLog.classes.LoggersManager(this),this.rootLogger=this.manager.rootLogger,this.appenders=[],this.configure(this.defaultConfig)},isLevelEnabled:function(a,b){return this.manager.isLevelEnabled(a,b)},doAppend:function(a,b,c){var d={date:new Date,logger:a,level:b,message:c};this.appenders.each(function(a){a.doAppend(d)})},logger:function(a){return this.manager.logger(a)},configure:function(a){a.loggers&&this.manager.configure(a.loggers),a.appenders&&(this.appenders=a.appenders),a.layouter&&(this.layouter=a.layouter)}}),a.extend(a.jqLog,{defaults:{layouter:new a.jqLog.classes.Layouter,appenders:[new a.jqLog.classes.ConsoleAppender],loggers:{root:{level:a.jqLog.Level.DEBUG}}}});var b=function(){var b=new a.jqLog.classes.JQLog(a.jqLog.defaults);return{_instance:b,rootLayouter:function(){return b.layouter},rootLogger:function(){return b.rootLogger},logger:function(a){return b.logger(a)},configure:function(a){b.configure(a)}}}();a.extend(a.jqLog,b)}(jQuery)
